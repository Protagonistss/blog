---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('posts');
const posts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 10);

// 获取所有分类和标签
const categories = [...new Set(allPosts.flatMap(post => post.data.categories))];
const tags = [...new Set(allPosts.flatMap(post => post.data.tags))];
---

<Layout title="首页" description="不迁怒，不二过。">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- 欢迎区域 -->
    <section class="text-center mb-12">
      <h1 class="text-5xl font-bold text-gray-900 dark:text-white mb-4">
        欢迎来到 protagonistss 的博客
      </h1>
      <p class="text-xl text-gray-600 dark:text-gray-400 mb-8">
        不迁怒，不二过。
      </p>
      <div class="flex justify-center gap-4 text-sm text-gray-500 dark:text-gray-500">
        <span>文章总数: {allPosts.length}</span>
        <span>分类: {categories.length}</span>
        <span>标签: {tags.length}</span>
      </div>
    </section>

    <!-- 最新文章 -->
    <section class="mb-12">
      <h2 class="text-3xl font-bold mb-8">最新文章</h2>
      <div class="space-y-6">
        {posts.map(post => (
          <article class="border border-gray-200 dark:border-gray-700 rounded-lg p-6 hover:shadow-md transition-shadow">
            <a href={`/posts/${post.slug}`} class="block">
              <h3 class="text-2xl font-semibold mb-3 text-gray-900 dark:text-white hover:text-primary-600 dark:hover:text-primary-400">
                {post.data.title}
              </h3>
              <p class="text-gray-600 dark:text-gray-400 mb-4">
                {post.data.description || '暂无描述'}
              </p>
              <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-gray-500">
                <time datetime={post.data.pubDate.toISOString()}>
                  {post.data.pubDate.toLocaleDateString('zh-CN')}
                </time>
                {post.data.categories.length > 0 && (
                  <div class="flex gap-2">
                    {post.data.categories.map(category => (
                      <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 rounded text-xs">
                        {category}
                      </span>
                    ))}
                  </div>
                )}
                {post.data.tags.length > 0 && (
                  <div class="flex gap-1">
                    {post.data.tags.map(tag => (
                      <span class="px-2 py-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded text-xs">
                        #{tag}
                      </span>
                    ))}
                  </div>
                )}
              </div>
            </a>
          </article>
        ))}
      </div>
    </section>

    <!-- 分类和标签 -->
    <section class="grid md:grid-cols-2 gap-8">
      <div>
        <h3 class="text-2xl font-bold mb-4">分类</h3>
        <div class="flex flex-wrap gap-2">
          {categories.map(category => (
            <a 
              href={`/categories/${category}`}
              class="px-3 py-1 bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 rounded-full text-sm hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors"
            >
              {category}
            </a>
          ))}
        </div>
      </div>
      
      <div>
        <h3 class="text-2xl font-bold mb-4">标签</h3>
        <div class="flex flex-wrap gap-2">
          {tags.map(tag => (
            <a 
              href={`/tags/${tag}`}
              class="px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-full text-sm hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
            >
              #{tag}
            </a>
          ))}
        </div>
      </div>
    </section>
  </div>
</Layout>
